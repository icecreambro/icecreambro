<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="Ice Cream, Delivery, UNL, College">
    <meta name="description" content="Your On-Demand, On-Campus Ice Cream Delivery">

    <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="css/full.css">
    <link rel="stylesheet" href="css/style.css">

    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="js/function.js"></script>

    <!-- Begin Google Analytics -->

    <script>
              (function(i, s, o, g, r, a, m) {
                  i['GoogleAnalyticsObject'] = r;
                  i[r] = i[r] || function() {
                      (i[r].q = i[r].q || []).push(arguments)
                  }, i[r].l = 1 * new Date();
                  a = s.createElement(o),
                      m = s.getElementsByTagName(o)[0];
                  a.async = 1;
                  a.src = g;
                  m.parentNode.insertBefore(a, m)
              })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
       
              ga('create', 'UA-75421301-1', 'auto');
              ga('send', 'pageview');

    </script>


    <link rel="icon" href="img/bowl.png">
    <title>Ice Cream Bro</title>
</head>

<body class="full">
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Ice Cream Bro</a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
                    <li><a href="valentines.html">Valentine's Day</a></li>
                    <li><a href="contact.html">Contact Us</a></li>
                    <li><a href="packages.html">Packages</a></li>
                    <li><a href="merch.html">Merch</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="landing-page text-center">
            <h1>Ice Cream Bro</h1>
            <h2>You need ice cream.<br>We bring it to you.</h2>
            <h3>Thursdays 8P-2A</h3>
            <p>Ordering for someone else? Do that <a href="packages.html">here</a>.<br>Ice cream parties happen <a href="party.html">here</a>.</p>
        </div>
        <div class="order">
            <form action="https://formspree.io/order@icecreambro.com" method="POST" class="form-horizontal">
                <fieldset class="info">
                    <legend>Info</legend>
                    <div class="col-sm-4">
                        <label>Name</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="col-sm-4">
                        <label>Phone Number</label>
                        <input type="text" class="form-control" name="number" required>
                    </div>
                    <div class="col-sm-4">
                        <label>Email</label>
                        <input type="text" class="form-control" name="email" required>
                    </div>
                    <div class="col-sm-6">
                        <label>Location</label>
                        <input type="text" class="form-control" name="location" required>
                    </div>
                    <div class="col-sm-6">
                        <label>Delivery Time</label>
                        <input type="time" class="form-control" name="time" step="300" required>
                    </div>
                </fieldset>
                <fieldset id="regular" class="flavors">
                    <legend>Regular Pints - $4</legend>
                    <div class="col-sm-6">
                        <div class="col-xs-8">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="sccd" onclick="showQuan('sccd')"> Super Chunky Cookie Dough
                                </label>
                            </div>
                        </div>
                        <div class="col-xs-4">
                            <select class="form-control" name="sccd-quantity" disabled>
                                <optgroup label="Quantity">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="col-xs-8">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="mcc" onclick="showQuan('mcc')"> Mint Chocolate Chip
                                </label>
                            </div>
                        </div>
                        <div class="col-xs-4">
                            <select class="form-control" name="mcc-quantity" disabled>
                                <optgroup label="Quantity">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="col-xs-8">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="sfb" onclick="showQuan('sfb')"> Super Fudge Brownie
                                </label>
                            </div>
                        </div>
                        <div class="col-xs-4">
                            <select class="form-control" name="sfb-quantity" disabled>
                                <optgroup label="Quantity">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="col-xs-8">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="scc" onclick="showQuan('scc')"> Salted Caramel Craze
                                </label>
                            </div>
                        </div>
                        <div class="col-xs-4">
                            <select class="form-control" name="scc-quantity" disabled>
                                <optgroup label="Quantity">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="col-xs-8">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="cc" onclick="showQuan('cc')"> Cookies &amp; Creme
                                </label>
                            </div>
                        </div>
                        <div class="col-xs-4">
                            <select class="form-control" name="cc-quantity" disabled>
                                <optgroup label="Quantity">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="col-xs-8">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="pbp" onclick="showQuan('pbp')"> Peanut Butter Party
                                </label>
                            </div>
                        </div>
                        <div class="col-xs-4">
                            <select class="form-control" name="pbp-quantity" disabled>
                                <optgroup label="Quantity">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                </fieldset>
                <fieldset id="special" class="flavors">
                    <legend>Dairy Free Pints - $6 </legend>
                    <div class="col-sm-6">
                        <div class="col-xs-8">
                             <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="cm" onclick="showQuan('cm')"> Chunky Monkey
                                </label>
                            </div>
                        </div>
                        <div class="col-xs-4">
                            <select class="form-control" name="cm-quantity" disabled>
                                <optgroup label="Quantity">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                </optgroup>
                            </select>
                        </div>
                         <div class="col-xs-8">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="cfb" onclick="showQuan('cfb')"> Chocolate Fudge Brownie
                                </label>
                            </div>
                        </div>
                        <div class="col-xs-4">
                            <select class="form-control" name="cfb-quantity" disabled>
                                <optgroup label="Quantity">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="col-xs-8">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="ccf" onclick="showQuan('ccf')"> Coffee Caramel Fudge
                                </label>
                            </div>
                        </div>
                        <div class="col-xs-4">
                            <select class="form-control" name="ccf-quantity" disabled>
                                <optgroup label="Quantity">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                </fieldset>  
                <div class="submit-button text-center">
                    <button type="submit" class="btn btn-primary btn-lg">Place Order</button>
                </div>
                <div class="col-sm-4 col-xs-6 col-sm-offset-3">
                    <input type="text" class="form-control" name="promo" placeholder="Promo Code">
                </div>
                <a class="btn btn-default promo" onclick="validateCode()">Apply Code</a>
                
                <input type="hidden" name="_next" value="complete.html" />
                <input type="hidden" name="_subject" value="" />
            </form>
        </div>
    </div>
    <script>

        // Call Square, check inventory, remove element
        $(document).ready(function() {
            $.ajax({
                url: 'https://connect.squareup.com/v1/0ZV4CY2PGCPX2/inventory',
                type: 'GET',
                beforeSend: function(xhr) {
                    xhr.setRequestHeader("Authorization", "BEARER " + 'sq0atp-K4-4TIU5WTHbVAi39c98gA');
                },
                success: function(R) {
                    var a = {
                        sccd: '76fcda92-7f9a-4c3b-aede-e2cfd597a7d1',
                        mcc: '698406f3-ca5e-4d7f-a0d3-817b619b25ab',
                        sfb: '4d3dde4a-e199-4acd-8c06-cd9455b3cb98',
                        scc: 'FD3036BA-9590-43F0-B5AD-BE95663B0F51',
                        cc: 'cd69dd3b-caa7-4860-ab33-1ae817ba4c6d',
                        pbp: '7ccb34f2-1b7c-45af-bdac-fd2171324776',
                        dairyFree: '7d670508-53d6-4eba-8877-6c2d7a29a70c'
                    }
                    for (var r in R) {
                        var i = R[r].variation_id,
                            q = R[r].quantity_on_hand,
                            b;
                        for (var e in a) {
                            if (a[e] == i && q < 1) {
                                b = $('[name=' + e + ']').closest('.col-xs-8');
                                $(b).next().remove();
                                $(b).remove();
                            }
                        }
                    }
                    CheckFieldset($('#regular'));
                    CheckFieldset($('#special'));
                }
            });
        })

        function CheckFieldset(e) {
            if ($(e).children().length == 1) {
                $(e).remove();
            }
        }
        
        // Variable to hold request
        var request;

        // Bind to the submit event of our form
        $(".order form").submit(function(event){

            // Abort any pending request
            if (request) {
                request.abort();
            }
            // setup some local variables
            var $form = $(this);

            // Let's select and cache all the fields
            var $inputs = $form.find("input, select, button");

            // Serialize the data in the form
            var serializedData = $form.serialize();

            // Fire off the request to /form.php
            request = $.ajax({
                url: "https://script.google.com/macros/s/AKfycbw2LU4d4FI5xyVZW6ih5ttXuUO7DCJ8vJnHOuht3FVmyjdbS9hb/exec",
                type: "get",
                data: serializedData
            });

            // Callback handler that will be called on success
            request.done(function (response, textStatus, jqXHR){
            });

            // Callback handler that will be called on failure
            request.fail(function (jqXHR, textStatus, errorThrown){
                // Log the error to the console
                console.error(
                    "The following error occurred: "+
                    textStatus, errorThrown
                );
            });

            // Callback handler that will be called regardless
            // if the request failed or succeeded
            request.always(function () {
                // Reenable the inputs
                $inputs.prop("disabled", false);
            });
        });

    </script>
</body>

</html>
